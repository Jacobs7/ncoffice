<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dape.shop.rpc.mapper.ShopUserOrderMapper">

	<resultMap id="BaseResultMap" type="com.dape.shop.dao.model.ShopUserOrder">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
		<result column="open_id" jdbcType="VARCHAR" property="openId" />
		<result column="wei_nick_name" jdbcType="VARCHAR" property="weiNickName" />
		<result column="head_url" jdbcType="VARCHAR" property="headUrl" />
		<result column="mobile" jdbcType="VARCHAR" property="mobile" />
		<result column="orderCount" jdbcType="INTEGER" property="orderCount" />
		<result column="orderGet" jdbcType="INTEGER" property="orderGet" />
	</resultMap>

	<select id="listUserOrderCount" resultType="int" parameterType="map">
		select count(0) from shop_user u where s_code = #{sCode}
	</select>
	<!-- 获取用户列表及订单数量 -->
	<select id="listUserOrder" resultMap="BaseResultMap" parameterType="map">
		select
		id,
		create_date,
		open_id,
		wei_nick_name,
		head_url,
		mobile,
		(select count(0) from shop_order o where o.shop_user_id = u.id) orderCount,
		(select count(0) from shop_order o where o.shop_user_id = u.id and o.status = 2) orderGet
		from shop_user u where s_code = #{sCode}
	</select>

	<!-- 缓存 -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache" />

</mapper>