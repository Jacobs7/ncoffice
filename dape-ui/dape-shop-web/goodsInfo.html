<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<title>宝贝详情</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">
<link rel="stylesheet" th:href="${uiPath + appName} + '/css/weui.min.css'">
<link rel="stylesheet" th:href="${uiPath + appName} + '/css/jquery-weui.css'">
<link rel="stylesheet" th:href="${uiPath + appName} + '/css/style.css'">
</head>
<body ontouchstart>
<!--主体-->
<div class="weui-content" id="listwrap">
  <!--产品详情-->

  <!--主图轮播-->
  <div class="weui-panel">
    <div class="swiper-container swiper-zhutu">
      <div class="swiper-wrapper" id="picList"></div>
      <div class="swiper-pagination swiper-zhutu-pagination"></div>
    </div>

    <div class="weui-media-box_text detail-container">
      <div class="detail-quan"><span class="quanFlag" style="width: 40px;" id="quanFlag">优惠券<br></span></div>
      <div class="detail-title" id="itemTitle"></div>
      <div class="detail-price-c" id="itemPrice"></div>
      <div class="detail-return">
        标准佣金&nbsp;¥<em id="biaoYong">0.00</em> ｜ 特权佣金&nbsp;¥<em id="teYong">0.00</em><a href="javascript:showKeFu('/upload/kefu.jpg')">如何升特权?</a>
      </div>
      <div class="detail-return-txt">
        以实际佣金为准，卖家修改佣金24小时内同步到平台
      </div>
    </div>
  </div>

  <div class="weui-panel">
    <!-- 推荐理由 -->
      <div class="detail-tj-title">推荐理由</div>
      <div class="detail-tj-content" id="itemDescription">------</div>
  </div>

  <div class="weui-panel">
    <div class="weui-tab" style="height:auto;">
      <div class="weui-navbar" style="height:2.1rem;">
        <a style="width: 50%;padding: 11px 0 9px 0;" class="weui-navbar__item proinfo-tab-tit weui-bar__item--on" href="#tab1">图文详情</a>
        <a style="width: 50%;padding: 11px 0 9px 0;" class="weui-navbar__item proinfo-tab-tit" href="#tab2">用户评价</a>
      </div>
      <div class="weui-tab__bd">
        <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">
          <div>
            <!-- 详情内容  -->
          </div>
          <div class="weui-cells__title" style="text-align: center;line-height: 3rem;padding-left:0;padding-right:0;">------已经到底了------</div>
        </div>
        <div id="tab2" class="weui-tab__bd-item">
          <div class="weui-cells__title" style="text-align: center;line-height: 3rem;">------已经到底了------</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 返回上页、查询页链接 -->
<div class="index-header">
    <div class="detail-back" style="left:0.5rem;top: 0.5rem;" onclick="javascript:history.back(-1);"><img style="margin: 20% auto auto 15%;" th:src="${uiPath} + ${appName} + '/images/icon-back_white.png'" /></div>
    <div class="detail-back" style="right:0.5rem;top: 0.5rem;" onclick="$('#searchForm').submit()"><img style="margin: 20% auto auto 20%;" th:src="${uiPath} + ${appName} + '/images/icon-search_white.png'" /></div>
</div>

<!-- 返回顶部 -->
<div class="detail-top" id="backTop">
  <img th:src="${uiPath} + ${appName} + '/images/icon_top.png'" />
</div>

<!--底部导航-->
<div class="foot-black"></div>
<div class="weui-tabbar wy-foot-menu">
  <a href="/" class="weui-tabbar__item">
    <div class="weui-tabbar__icon foot-menu-home"></div>
    <p class="weui-tabbar__label">商城首页</p>
  </a>

  <a href="javascript:;qiangquan()" class="weui-tabbar__item yellow-color open-popup" data-target="#join_cart">
    <p class="promotion-foot-menu-label" style="font-size: 0.8rem;">去抢券</p>
  </a>
  <a href="javascript:;haibao()" class="weui-tabbar__item red-color open-popup" data-target="#selcet_sku">
    <p class="promotion-foot-menu-label" style="font-size: 0.8rem;">生成推广海报</p>
  </a>
</div>

<!-- 查询页链接提交form，隐藏 -->
<div style="display: none;">
<form action="/goods/toSearch" method="post" id="searchForm">
  <input type="hidden" name="pageNum" value="1" />
  <input type="hidden" name="pageSize" value="20" />
  <input type="hidden" name="title" value="" />
</form>
</div>
<div id="toastContainer"></div>
<script th:src="${uiPath + appName} + '/js/jquery-2.1.4.js'"></script>
<script th:src="${uiPath + appName} + '/js/swiper.js'"></script>
<script th:src="${uiPath + appName} + '/js/jquery-weui.js'"></script>
<script th:src="${uiPath + appName} + '/js/fastclick.js'"></script>
<script th:src="${uiPath + appName} + '/js/common.js'"></script>
<script th:src="${uiPath + appName} + '/js/clipboard.min.js'"></script>
<script th:inline="javascript">
  var appURL = [[${uiPath}]] + [[${appName}]];
  var goodsDetail = [[${goodsDetail}]];
  var commission_rate = [[${commission_rate}]];
  var coupon_amount = [[${coupon_amount}]];
  var coupon_click_url = [[${coupon_click_url}]];
  var click_url = [[${click_url}]];
  var item_description = [[${item_description}]];
  var numIid,title,userType,pictUrl,zkPrice,zkFinalPrice,reservePrice,volume,freeShipment=false;

  function loadInfo(){
    if(!!goodsDetail && goodsDetail.length > 0){
      var item = goodsDetail[0];
      numIid = item['num_iid'];
      // 商品图片
      pictUrl = item['pict_url'];
      $('#picList').append('<div class="swiper-slide"><img src="'+pictUrl+'" /></div>');
      var small_images = item['small_images'];
      if(!!small_images && small_images['string'].length > 0){
        for(var i = 0; i < small_images['string'].length; i++){
          $('#picList').append('<div class="swiper-slide"><img src="'+small_images['string'][i]+'" /></div>');
        }
      }
      // 券
      $('#quanFlag').append('<b>￥'+coupon_amount+'</b>');
      userType = item['user_type'];
      if(userType == 0){// 淘宝图标
        $('#itemTitle').append('<i class="icon18-zz icon-tianmao-18"></i>');
      }else if(userType == 1){// 天猫图标
        $('#itemTitle').append('<i class="icon18-zz icon-tianmao-18"></i>');
      }
      title = item['title'];
      $('#itemTitle').append('<em style="padding:1.1rem;">'+title+'</em>');
      // 原价、折扣价
      zkFinalPrice = item['zk_final_price'];
      zkPrice = jsSubtr(zkFinalPrice,coupon_amount);
      $('#itemPrice').append('<em class="num" style="font-size: 0.95rem;font-weight: bold;">¥'+zkPrice+'</em>');
      $('#itemPrice').append('<em class="detail-price-s">原价'+zkFinalPrice+'</em>');
      volume = item['volume'];
      $('#itemPrice').append('<em class="detail-price-v">月销量'+volume+'</em>');
      // 包邮
      if(!!item['free_shipment']){
        freeShipment = item['free_shipment'];
      }
      // 佣金
      $('#biaoYong').text(byFnc(zkPrice,commission_rate));
      $('#teYong').text(tyFnc(zkPrice,commission_rate));
      if(item_description != ''){
        $('#itemDescription').text(item_description);
      }else{
        $('#itemDescription').css('text-align','center');
      }
      // 详情

      // 评价

    }
  }

  var platform = [[${platform}]];
  var txt = '';
  var tkl = '';

  // 抢券淘口令
  function qiangquan(){
    if(tkl == ''){
        $.post('/goods/goodsTPwd',{url:coupon_click_url,text:title},function(data){
            if(data.success){
                tkl = txt+data.model+'复制这条信息，打开手机淘宝即可领券';
                showTKLWin(tkl);
            }else{
                toast('');
                if(data.msg){
                  toast(data.msg);
                }else{
                  toast('获取淘口令失败');
                }
            }

        });
    }else{
        showTKLWin(tkl);
    }

  }
  function showTKLWin(kl){
        var dialogId = 'qianquan';
      var title = '<div style="background-color: #F54D23;color: #fff;font-size: 1rem;padding:0.25rem 0 0 0;line-height: 2.5rem;"><em>抢券淘口令</em><a style="position: absolute;right:0.25rem;top:0.2rem;font-size: 1.25rem;color:#E9E9E9;width:2rem;" id="'+dialogId+'Close" href="javascript:">X</a></div>';
      var content = '<div id="copyDiv" class="puBody">' +
            '<h2><em>长按框内 <u class="p3">&gt;</u> 全选 <u class="p3">&gt;</u> 复制</em></h2>' +
            '<form name="puKoulingForm" id="puKoulingForm">' +
              '<textarea class="inputArea inputArea-2" id="copyKeyAndroid">'+kl+'</textarea>' +
            '</form>' +
          '</div>' +
          '<div id="copyButton" class="imne-copy-btn" style="display: block;" onclick="cloneTxt(\'copyButton\')" data-clipboard-text="'+kl+'">一键复制</div>' +
          '<div class="hasCoupon" style="display: block;" id="hasCoupon">复制淘口令，打开【手机淘宝】即可领券！</div>';
      var footer = '';
      createDialog(dialogId,title,content,footer);
      showDialog(dialogId);
      // showLoading('正在获取淘口令','style="min-width: 6.5rem;min-height: 6.5rem;"');
      // $.post('/goods/quanKey',{goodId:''},function (data){
      //     $.hideLoading();
      //     if(data && data.copyTxt){
      //         $('#copyButton').attr('data-clipboard-text', data.copyTxt);
      //         $('#copyKeyAndroid').text(data.copyTxt);
      //         $('#copyButton').click(function (e) {
      //             cloneTxt('copyButton');
      //         })
      //     }
      //     showDialog(dialogId);
      // });
      // colseDialog(dialogId);
  }

  // 生成推广海报
  function haibao() {
      if(!!goodsDetail && goodsDetail.length > 0){
          var dialogId = 'haibao';
          var len = $('#'+dialogId+'Win').length;
          var content = '<div class="haibaoContent"><img id="goodsHaibao" onload="imgloadComplent(\''+dialogId+'\')"/></div><div class="haibao-c-remark" style="color: #d47b4f;">长按图片发送给朋友，或保存到手机</div><div class="haibao-c-remark" style="color: #d9d9db;">好友通过领券购买，您即可赚取佣金</div>';
          var footer = '<div class="haibaoFoot"><a href="javascript:" id="copyTitle" onclick="cloneTxt(\'copyTitle\')" data-clipboard-text="'+title+'">复制标题</a><a href="javascript:" id="copyText" onclick="cloneTxt(\'copyText\')" data-clipboard-text="'+txt+'长按识别二维码，复制口伶或网址，打开手机淘宝，领券下单'+'">复制文案</a><a href="javascript:closeDialog(\''+dialogId+'\')">关闭</a></div>';
          createDialog(dialogId,'',content,footer);
          $.post('/goods/haibao',{
              shopType : userType,
              platform : platform,
              numIid : numIid,
              pictUrl : pictUrl,
              title : title,
              zkFinalPrice : zkFinalPrice,
              reservePrice : reservePrice,
              freeShipment : freeShipment,
              volume : volume,
              couponInfo : '0.00'//未确定
          },function (data) {
              $('#goodsHaibao').attr('src',data.url);
          });
          if(len > 0){
              showDialog(dialogId);
          }else{
              //$.showLoading('正在生成<br>分享图片');// 自带的不能调节宽高
              showLoading('正在生成海报','style="min-width: 7.5rem;min-height: 7.5rem;"');
          }
      }
  }
  $(function() {
      FastClick.attach(document.body);
      loadInfo();
      $("#listwrap").height($(document.body).height()-44);
      $(".swiper-zhutu").swiper({
          loop: true,
          paginationType:'fraction',
          autoplay:5000
      });
      // 返回顶部
      //backScroll('listwrap');
      txt = title + '\n----------\n券后￥'+zkPrice+'【优惠券'+coupon_amount+'元】\n原价￥'+zkFinalPrice + (userType==0?'【淘宝】':userType==1?'【天猫】':'')+'\n----------\n'+(item_description!=''?item_description+'\n':'')+'----------\n';
  });
</script>
</body>
</html>
